<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è™šæ‹ŸæŠ¢ç¥¨ - ä½ å¥½å—</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .seat-map-container {
            margin: 30px auto;
            max-width: 1000px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 15px;
            position: relative;
        }
        
        .seat-map {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            gap: 6px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .seat {
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #2ecc71;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
            user-select: none;
            margin: 0 auto;
            font-size: 11px;
            color: white;
            border: 2px solid #27ae60;
        }
        
        .seat:hover {
            transform: scale(1.08);
        }
        
        .seat.selected {
            background: #e74c3c;
            border-color: #c0392b;
            color: white;
        }
        
        .seat.occupied {
            background-color: #95a5a6;
            border-color: #7f8c8d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .seat.disabled {
            background-color: #bdc3c7;
            border-color: #95a5a6;
            cursor: not-allowed;
            opacity: 0.3;
        }
        
        .screen {
            background: linear-gradient(90deg, #333, #666, #333);
            color: white;
            text-align: center;
            padding: 15px;
            margin: 20px auto 30px;
            max-width: 800px;
            border-radius: 5px;
            font-size: 1.5rem;
            letter-spacing: 3px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            grid-column: 1 / -1;
        }
        
        .info-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 15px;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .step.active .step-number {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
        }
        
        .seat-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .selected-seats-list {
            max-height: 120px;
            overflow-y: auto;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        
        .selected-seats-list ul {
            margin: 0;
            padding: 0;
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .selected-seats-list li {
            background: #e9ecef;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
        }
        
        .aisle {
            grid-column: span 1;
        }
        
        .row-label {
            position: absolute;
            left: -25px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #2c3e50;
            font-size: 12px;
        }
        
        /* ç®€å•çš„ä¸€é”®åŒ…åœºæŒ‰é’®æ ·å¼ */
        .book-all-btn {
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .book-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        /* åº§ä½ç»Ÿè®¡ */
        .seat-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .seat-stat-item {
            background: #f8f9fa;
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid #dee2e6;
        }
        
                @media (max-width: 768px) {
            /* ä¿®å¤é¡¶éƒ¨é—´è· */
            .container.mt-5.pt-4 {
                padding-top: 80px !important;
                margin-top: 0 !important;
            }
            
            /* ä¼˜åŒ–åº§ä½å›¾ */
            .seat-map {
                grid-template-columns: repeat(12, 1fr); /* å‡å°‘åˆ—æ•° */
                gap: 4px;
                max-width: 100%;
                overflow-x: auto;
                padding: 10px;
            }
            
            /* å¢å¤§åº§ä½ç‚¹å‡»åŒºåŸŸ */
            .seat {
                width: 32px;
                height: 32px;
                font-size: 11px;
                min-width: 32px; /* é˜²æ­¢è¢«å‹ç¼© */
            }
            
            /* è¡Œæ ‡ç­¾è°ƒæ•´ */
            .row-label {
                left: -15px;
                font-size: 11px;
            }
            
            /* ä¿¡æ¯é¢æ¿å †å  */
            .info-panel {
                padding: 20px;
                margin-top: 20px;
            }
            
            /* æ­¥éª¤æŒ‡ç¤ºå™¨æ¢è¡Œ */
            .step-indicator {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .step {
                margin: 0 5px;
            }
            
            /* å±å¹•æ–‡å­—è°ƒæ•´ */
            .screen {
                font-size: 1.2rem;
                padding: 10px;
                margin: 10px auto 20px;
                max-width: 95%;
            }
            
            /* æ§åˆ¶æŒ‰é’®å †å  */
            .seat-controls {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .book-all-btn {
                width: 100%;
                max-width: 200px;
                justify-content: center;
            }
            
            /* åº§ä½ç»Ÿè®¡æ¢è¡Œ */
            .seat-stats {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            /* å·²é€‰åº§ä½åˆ—è¡¨ä¼˜åŒ– */
            .selected-seats-list {
                max-height: 100px;
            }
            
            /* æŒ‰é’®æ–‡å­—å¤§å° */
            .btn-lg {
                font-size: 1rem;
                padding: 12px 20px;
            }
            
            /* é—¨ç¥¨é¢„è§ˆè°ƒæ•´ */
            .e-ticket-preview {
                padding: 15px;
            }
            
            #ticketSeats {
                font-size: 0.9rem;
                word-break: break-all;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-film me-2"></i>ä½ å¥½å—
            </a>
            <div class="navbar-nav">
                <a class="nav-link text-white" href="index.html">
                    <i class="fas fa-home me-1"></i>è¿”å›é¦–é¡µ
                </a>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="container mt-5 pt-4">
        <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
        <div class="step-indicator">
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <span>é€‰æ‹©åº§ä½</span>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <span>ç¡®è®¤ä¿¡æ¯</span>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <span>ç”Ÿæˆé—¨ç¥¨</span>
            </div>
        </div>

        <!-- å±å¹• -->
        <div class="screen">
            ğŸ¬ IMAXå·¨å¹•å… (150åº§ä½) ğŸ¬
        </div>

        <!-- é€‰åº§åŒºåŸŸ -->
        <div id="seatSelectionSection">
            <h3 class="text-center mb-4">è¯·é€‰æ‹©åº§ä½</h3>
            
            <!-- åº§ä½ç»Ÿè®¡ -->
            <div class="seat-stats">
                <div class="seat-stat-item">æ€»åº§ä½: <strong>150</strong></div>
                <div class="seat-stat-item">å¯ç”¨: <strong id="availableSeats">146</strong></div>
                <div class="seat-stat-item">å·²é€‰: <strong id="selectedCount">0</strong></div>
                <div class="seat-stat-item">æ€»ä»·: <strong id="totalPrice">0</strong>å…ƒ</div>
            </div>
            
            <!-- åº§ä½æ“ä½œæ§åˆ¶ -->
            <div class="seat-controls">
                <button class="btn btn-outline-info" id="clearSelectionBtn">
                    <i class="fas fa-times me-2"></i>æ¸…ç©ºé€‰æ‹©
                </button>
                <button class="book-all-btn" id="bookAllBtn">
                    <i class="fas fa-crown me-2"></i>ä¸€é”®åŒ…åœº
                </button>
            </div>
            
            <!-- åº§ä½å›¾å®¹å™¨ -->
            <div class="seat-map-container">
                <div class="seat-map" id="seatMap">
                    <!-- åº§ä½é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- åº§ä½å›¾ä¾‹ -->
                <div class="row justify-content-center mt-4">
                    <div class="col-auto">
                        <div class="d-flex align-items-center mb-2">
                            <div class="seat me-2" style="background:#2ecc71;"></div>
                            <span>å¯é€‰åº§ä½</span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="d-flex align-items-center mb-2">
                            <div class="seat me-2 selected" style="background:#e74c3c;"></div>
                            <span>å·²é€‰åº§ä½</span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="d-flex align-items-center mb-2">
                            <div class="seat me-2 occupied" style="background:#95a5a6;"></div>
                            <span>å·²å”®åº§ä½</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å·²é€‰åº§ä½åˆ—è¡¨ -->
            <div class="selected-seats-list">
                <h6><i class="fas fa-list me-2"></i>å·²é€‰åº§ä½ï¼š</h6>
                <ul id="selectedSeatsList">
                    <!-- å·²é€‰åº§ä½ä¼šåŠ¨æ€æ·»åŠ  -->
                </ul>
            </div>
            
            <!-- ä¿¡æ¯é¢æ¿ -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="info-panel">
                        <h4><i class="fas fa-ticket-alt me-2"></i>åº§ä½ä¿¡æ¯</h4>
                        <p id="selectedSeatInfo" class="text-muted">å°šæœªé€‰æ‹©åº§ä½</p>
                        <div class="h4 text-success" id="priceDisplay">0 å…ƒ</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-panel">
                        <h4><i class="fas fa-check-circle me-2"></i>æ“ä½œ</h4>
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary btn-lg" id="confirmSeatBtn" disabled>
                                <i class="fas fa-check me-2"></i>ç¡®è®¤é€‰æ‹© (<span id="selectedCountBtn">0</span>ä¸ªåº§ä½)
                            </button>
                            <p class="text-muted small mt-2">è‡³å°‘é€‰æ‹©1ä¸ªåº§ä½å¯è¿›å…¥ä¸‹ä¸€æ­¥</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¡®è®¤ä¿¡æ¯åŒºåŸŸ -->
        <div id="confirmSection" style="display: none;">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="info-panel">
                        <h3 class="text-center mb-4"><i class="fas fa-clipboard-check me-2"></i>ç¡®è®¤è´­ç¥¨ä¿¡æ¯</h3>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            è¿™æ˜¯è™šæ‹Ÿè´­ç¥¨æ¼”ç¤ºï¼Œä¸ä¼šçœŸå®æ‰£æ¬¾ã€‚
                        </div>
                        
                        <div class="text-center py-4">
                            <h4>åº§ä½æ•°é‡ï¼š<span id="confirmSeatCount" class="text-primary">--</span> ä¸ª</h4>
                            <h4>åº§ä½å·ï¼š<span id="confirmSeats" class="text-primary">--</span></h4>
                            <h4 class="mt-3">æ€»ä»·ï¼š<span id="confirmPrice" class="text-success">-- å…ƒ</span></h4>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-center mt-4">
                            <button class="btn btn-outline-secondary btn-lg" id="backToSeatBtn">
                                <i class="fas fa-arrow-left me-2"></i>è¿”å›é‡æ–°é€‰åº§
                            </button>
                            <button class="btn btn-success btn-lg" id="simulatePayBtn">
                                <i class="fas fa-credit-card me-2"></i>æ¨¡æ‹Ÿæ”¯ä»˜
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é—¨ç¥¨é¢„è§ˆåŒºåŸŸ -->
        <div id="ticketSection" style="display: none;">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="e-ticket-preview">
                        <div class="text-center border-bottom pb-3 mb-3">
                            <h2 class="text-primary">ğŸ« è™šæ‹Ÿè§‚å½±ç¥¨</h2>
                            <p class="text-muted">çºªå¿µç”µå­ç¥¨</p>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <h4>ã€Šè™šæ‹Ÿè§‚å½±ä½“éªŒã€‹</h4>
                                <p><i class="fas fa-calendar me-2"></i>æ—¶é—´ï¼š<span id="ticketDate">2024å¹´6æœˆ1æ—¥ 19:30</span></p>
                                <p><i class="fas fa-chair me-2"></i>åº§ä½æ•°é‡ï¼š<span id="ticketSeatCount" class="fw-bold">--</span> ä¸ª</p>
                                <p><i class="fas fa-chair me-2"></i>åº§ä½å·ï¼š<span id="ticketSeats" class="fw-bold">--</span></p>
                                <p><i class="fas fa-tag me-2"></i>æ€»ä»·ï¼š<span id="ticketPrice" class="fw-bold">-- å…ƒ</span></p>
                                <p class="small text-muted mt-3">ç¥¨å·ï¼š<span id="ticketNumber">TICKET-001</span></p>
                            </div>
                            <div class="col-md-4 text-center">
                                <div style="width:120px;height:120px;background:#333;border-radius:10px;margin:0 auto;display:flex;align-items:center;justify-content:center;color:white;">
                                    <div>
                                        <i class="fas fa-qrcode fa-3x"></i>
                                        <p class="small mb-0 mt-2">æ‰«ç éªŒç¥¨</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4 pt-3 border-top">
                            <p class="fst-italic text-success" id="ticketMessage">"æ„Ÿè°¢æ”¯æŒï¼Œç¥è§‚å½±æ„‰å¿«ï¼"</p>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button class="btn btn-primary btn-lg me-3" id="saveTicketBtn">
                            <i class="fas fa-download me-2"></i>ä¿å­˜é—¨ç¥¨
                        </button>
                        <a href="index.html" class="btn btn-outline-primary btn-lg">
                            <i class="fas fa-home me-2"></i>è¿”å›é¦–é¡µ
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

  

        <!-- è„šæœ¬ -->
    <!-- 1. å…ˆå¼•å…¥api.js -->
    <script src="api.js"></script>
    <!-- 2. å†å¼•å…¥bootstrap -->
    <script src="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ==================== æŠ¢ç¥¨é¡µé¢è„šæœ¬ï¼ˆ150åº§ä½ç‰ˆæœ¬ï¼‰ ====================
        
        // é¡µé¢çŠ¶æ€
        const seatState = {
            selectedSeats: new Set(),
            currentPrice: 0,
            mode: 'exam',
            score: 100,
            maxSelectable: 150,
            seatPrice: 60,
            packageDiscount: 0.7,
            isPackage: false,
            totalSeats: 150,
            availableSeats: 146
        };

        // ä¿®æ”¹äº‹ä»¶ç›‘å¬ï¼Œæ·»åŠ APIæ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
            
            // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæ¯•
            setTimeout(async function() {
                // æ£€æŸ¥APIæ˜¯å¦å·²å®šä¹‰
                if (typeof API === 'undefined') {
                    console.error('âŒ APIæœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢');
                    alert('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                    return;
                }
                
                console.log('âœ… APIå·²åŠ è½½ï¼Œå¼€å§‹åˆå§‹åŒ–');
                
                // æ£€æŸ¥ç›´æ¥æŠ¢ç¥¨é€šé“
                const urlParams = new URLSearchParams(window.location.search);
                seatState.mode = urlParams.get('mode') || 'exam';
                seatState.score = parseInt(urlParams.get('score')) || 100;
                
                if (seatState.mode === 'direct') {
                    try {
                        const config = await API.getConfig();
                        if (!config.directTicketEnabled) {
                            showChannelClosedMessage();
                            return;
                        }
                    } catch (error) {
                        showChannelClosedMessage();
                        return;
                    }
                }
                
                // åˆå§‹åŒ–é¡µé¢
                initPage();
            }, 100); // å»¶è¿Ÿ100msç¡®ä¿api.jså®Œå…¨åŠ è½½
        });

        // æ˜¾ç¤ºé€šé“å…³é—­æç¤º
        function showChannelClosedMessage() {
            document.body.innerHTML = `
                <div class="container mt-5 pt-5 text-center">
                    <div class="card border-warning">
                        <div class="card-body py-5">
                            <i class="fas fa-clock fa-5x text-warning mb-4"></i>
                            <h2 class="text-warning">â³ é€šé“æš‚æœªå¼€æ”¾</h2>
                            <p class="lead">ç›´æ¥æŠ¢ç¥¨é€šé“å½“å‰æœªå¼€æ”¾</p>
                            <div class="mt-4">
                                <a href="ticket.html?mode=exam" class="btn btn-primary btn-lg me-3">
                                    <i class="fas fa-brain me-2"></i>å»ç­”é¢˜æŠ¢ç¥¨
                                </a>
                                <a href="index.html" class="btn btn-outline-secondary btn-lg">
                                    <i class="fas fa-home me-2"></i>è¿”å›é¦–é¡µ
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            console.log('åˆå§‹åŒ–150åº§ä½é¡µé¢');
            
            // åˆ›å»º150ä¸ªåº§ä½
            createSeats();
            
            // ç»‘å®šäº‹ä»¶
            bindEvents();
            
            // æ›´æ–°é—¨ç¥¨ä¿¡æ¯
            updateTicketInfo();
            
            // æ›´æ–°åº§ä½ç»Ÿè®¡
            updateSeatStats();
        }

        // åˆ›å»º150ä¸ªåº§ä½
        function createSeats() {
            const seatMap = document.getElementById('seatMap');
            seatMap.innerHTML = '';
            
            // å·²å”®åº§ä½ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰
            const bookedSeats = new Set(['A1', 'A2', 'J14', 'J15']);
            
            // 10è¡Œ (A-J)ï¼Œæ¯è¡Œ15åˆ—
            const rows = ['A','B','C','D','E','F','G','H','I','J'];
            
            rows.forEach((row, rowIndex) => {
                // æ·»åŠ è¡Œæ ‡ç­¾
                const rowLabel = document.createElement('div');
                rowLabel.className = 'row-label';
                rowLabel.style.top = `${(rowIndex * 41) + 20}px`;
                rowLabel.textContent = row;
                seatMap.appendChild(rowLabel);
                
                for (let col = 1; col <= 15; col++) {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯è¿‡é“ (ç¬¬6ã€11åˆ—ä¸ºè¿‡é“)
                    if (col === 6 || col === 11) {
                        const aisle = document.createElement('div');
                        aisle.className = 'aisle';
                        seatMap.appendChild(aisle);
                        continue;
                    }
                    
                    const seatId = `${row}${col}`;
                    const seat = document.createElement('div');
                    seat.className = 'seat';
                    seat.dataset.seat = seatId;
                    seat.textContent = col;
                    
                    // æ£€æŸ¥åº§ä½çŠ¶æ€
                    if (bookedSeats.has(seatId)) {
                        // å·²å”®åº§ä½
                        seat.classList.add('occupied');
                        seat.title = 'å·²å”®';
                    } else {
                        // å¯ç”¨åº§ä½
                        seat.addEventListener('click', () => selectSeat(seatId, seat));
                        seat.title = `ç‚¹å‡»é€‰æ‹© ${seatId}`;
                    }
                    
                    seatMap.appendChild(seat);
                }
            });
            
            console.log('âœ… åˆ›å»ºäº†150ä¸ªåº§ä½');
        }

        // é€‰æ‹©åº§ä½
        function selectSeat(seatId, seatElement) {
            const seatStateSet = seatState.selectedSeats;
            
            if (seatStateSet.has(seatId)) {
                // å–æ¶ˆé€‰æ‹©
                seatStateSet.delete(seatId);
                seatElement.classList.remove('selected');
            } else {
                // æ£€æŸ¥æ˜¯å¦è¶…è¿‡æœ€å¤§é€‰æ‹©æ•°é‡
                if (seatStateSet.size >= seatState.maxSelectable) {
                    alert(`æœ€å¤šåªèƒ½é€‰æ‹© ${seatState.maxSelectable} ä¸ªåº§ä½`);
                    return;
                }
                
                // é€‰æ‹©åº§ä½
                seatStateSet.add(seatId);
                seatElement.classList.add('selected');
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updateSelectionDisplay();
            updateSeatStats();
        }

        // ä¸€é”®åŒ…åœºåŠŸèƒ½
        function bookAllSeats() {
            // ç¡®è®¤æ˜¯å¦è¦åŒ…åœº
            if (!confirm(`æ˜¯å¦è¦åŒ…ä¸‹å…¨éƒ¨ ${seatState.availableSeats} ä¸ªå¯ç”¨åº§ä½ï¼Ÿ`)) {
                return;
            }
            
            // æ¸…é™¤å½“å‰é€‰æ‹©
            clearSelection();
            
            // è·å–æ‰€æœ‰å¯ç”¨åº§ä½
            const availableSeats = document.querySelectorAll('.seat:not(.occupied)');
            
            // é€‰æ‹©æ‰€æœ‰å¯ç”¨åº§ä½
            availableSeats.forEach(seat => {
                const seatId = seat.dataset.seat;
                seatState.selectedSeats.add(seatId);
                seat.classList.add('selected');
            });
            
            // æ›´æ–°æ˜¾ç¤º
            updateSelectionDisplay();
            updateSeatStats();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            alert(`ğŸ‰ ä¸€é”®åŒ…åœºæˆåŠŸï¼å·²é€‰æ‹©å…¨éƒ¨ ${seatState.availableSeats} ä¸ªåº§ä½`);
        }

        // æ¸…ç©ºé€‰æ‹©
        function clearSelection() {
            // æ¸…é™¤æ‰€æœ‰é€‰ä¸­çš„åº§ä½æ ·å¼
            document.querySelectorAll('.seat.selected').forEach(seat => {
                seat.classList.remove('selected');
            });
            
            // æ¸…ç©ºé€‰æ‹©é›†åˆ
            seatState.selectedSeats.clear();
            
            // æ›´æ–°æ˜¾ç¤º
            updateSelectionDisplay();
            updateSeatStats();
        }

        // æ›´æ–°é€‰æ‹©æ˜¾ç¤º
        function updateSelectionDisplay() {
            const selectedCount = seatState.selectedSeats.size;
            const selectedList = Array.from(seatState.selectedSeats);
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('confirmSeatBtn').disabled = selectedCount === 0;
            document.getElementById('selectedCount').textContent = selectedCount;
            document.getElementById('selectedCountBtn').textContent = selectedCount;
            
            // æ›´æ–°åº§ä½ä¿¡æ¯
            if (selectedCount === 0) {
                document.getElementById('selectedSeatInfo').textContent = 'å°šæœªé€‰æ‹©åº§ä½';
                document.getElementById('selectedSeatInfo').className = 'text-muted';
            } else {
                document.getElementById('selectedSeatInfo').textContent = `å·²é€‰æ‹© ${selectedCount} ä¸ªåº§ä½`;
                document.getElementById('selectedSeatInfo').className = 'text-success fw-bold';
                
                // æ›´æ–°åº§ä½åˆ—è¡¨
                const seatsList = document.getElementById('selectedSeatsList');
                seatsList.innerHTML = '';
                selectedList.forEach(seat => {
                    const li = document.createElement('li');
                    li.textContent = seat;
                    seatsList.appendChild(li);
                });
            }
            
            // æ›´æ–°ä»·æ ¼
            updatePrice();
        }

        // æ›´æ–°ä»·æ ¼
        function updatePrice() {
            const selectedCount = seatState.selectedSeats.size;
            let totalPrice = seatState.seatPrice * selectedCount;
            
            // åŒ…åœºä¼˜æƒ ï¼ˆé€‰æ‹©è¶…è¿‡80%çš„åº§ä½ï¼‰
            if (selectedCount >= Math.floor(seatState.availableSeats * 0.8)) {
                totalPrice *= seatState.packageDiscount;
                document.getElementById('selectedSeatInfo').innerHTML += ' <span class="text-warning">(åŒ…åœºä¼˜æƒ )</span>';
            }
            
            seatState.currentPrice = parseFloat(totalPrice.toFixed(1));
            document.getElementById('priceDisplay').textContent = seatState.currentPrice.toFixed(1) + ' å…ƒ';
            document.getElementById('totalPrice').textContent = seatState.currentPrice.toFixed(1);
        }

        // æ›´æ–°åº§ä½ç»Ÿè®¡
        function updateSeatStats() {
            const selectedCount = seatState.selectedSeats.size;
            const availableCount = seatState.availableSeats - selectedCount;
            
            document.getElementById('availableSeats').textContent = availableCount;
            document.getElementById('selectedCount').textContent = selectedCount;
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // æ¸…ç©ºé€‰æ‹©æŒ‰é’®
            document.getElementById('clearSelectionBtn').addEventListener('click', clearSelection);
            
            // ä¸€é”®åŒ…åœºæŒ‰é’®
            document.getElementById('bookAllBtn').addEventListener('click', bookAllSeats);
            
            // ç¡®è®¤åº§ä½æŒ‰é’®
            document.getElementById('confirmSeatBtn').addEventListener('click', function() {
                const selectedCount = seatState.selectedSeats.size;
                if (selectedCount === 0) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªåº§ä½ï¼');
                    return;
                }
                
                const selectedSeats = Array.from(seatState.selectedSeats).join(', ');
                
                // åˆ‡æ¢åˆ°ç¡®è®¤é¡µé¢
                document.getElementById('seatSelectionSection').style.display = 'none';
                document.getElementById('confirmSection').style.display = 'block';
                document.getElementById('confirmSeatCount').textContent = selectedCount;
                document.getElementById('confirmSeats').textContent = selectedSeats;
                document.getElementById('confirmPrice').textContent = seatState.currentPrice.toFixed(1) + ' å…ƒ';
                
                // æ›´æ–°æ­¥éª¤
                updateSteps(2);
            });
            
            // è¿”å›é€‰åº§æŒ‰é’®
            document.getElementById('backToSeatBtn').addEventListener('click', function() {
                document.getElementById('confirmSection').style.display = 'none';
                document.getElementById('seatSelectionSection').style.display = 'block';
                updateSteps(1);
            });
            
            // æ¨¡æ‹Ÿæ”¯ä»˜æŒ‰é’®
            document.getElementById('simulatePayBtn').addEventListener('click', function() {
                const selectedCount = seatState.selectedSeats.size;
                const selectedSeats = Array.from(seatState.selectedSeats).join(', ');
                
                // åˆ‡æ¢åˆ°é—¨ç¥¨é¡µé¢
                document.getElementById('confirmSection').style.display = 'none';
                document.getElementById('ticketSection').style.display = 'block';
                document.getElementById('ticketSeatCount').textContent = selectedCount;
                document.getElementById('ticketSeats').textContent = selectedSeats;
                document.getElementById('ticketPrice').textContent = seatState.currentPrice.toFixed(1) + ' å…ƒ';
                
                // æ›´æ–°æ­¥éª¤
                updateSteps(3);
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                setTimeout(function() {
                    alert(`ğŸ‰ æ”¯ä»˜æˆåŠŸï¼è´­ä¹° ${selectedCount} ä¸ªåº§ä½ï¼Œé—¨ç¥¨å·²ç”Ÿæˆ`);
                }, 300);
            });
            
            // ä¿å­˜é—¨ç¥¨æŒ‰é’®
            document.getElementById('saveTicketBtn').addEventListener('click', function() {
                alert('âœ… é—¨ç¥¨å·²ä¿å­˜åˆ°æœ¬åœ°ï¼ˆæ¨¡æ‹ŸåŠŸèƒ½ï¼‰');
            });
        }

        // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
        function updateSteps(stepNum) {
            document.querySelectorAll('.step').forEach((step, index) => {
                step.classList.remove('active');
                if (index + 1 === stepNum) {
                    step.classList.add('active');
                }
            });
        }

        // æ›´æ–°é—¨ç¥¨ä¿¡æ¯
        function updateTicketInfo() {
            const now = new Date();
            const futureDate = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            const formatDate = (date) => {
                return `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
            };
            
            const ticketNumber = 'TICKET-' + now.getFullYear() + 
                                (now.getMonth() + 1).toString().padStart(2, '0') + 
                                now.getDate().toString().padStart(2, '0') + '-' + 
                                Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            
            document.getElementById('ticketDate').textContent = formatDate(futureDate);
            document.getElementById('ticketNumber').textContent = ticketNumber;
        }
    </script>
    
</body>
</html>